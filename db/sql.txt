CREATE TABLE users(
    userID INT AUTO_INCREMENT,
    phoneNumber VARCHAR(10) NOT NULL,
    memberName TEXT(50) NOT NULL,
    email TEXT(1000) NOT NULL,
    status TEXT CHECK( status IN ("ACTIVE", "INAVTIVE") ) NOT NULL DEFAULT "ACTIVE",
    points INT DEFAULT 0 NOT NULL,
    role TEXT CHECK(role IN ("MEMBER", "MANAGER", "STAFF") ) NOT NULL DEFAULT "MEMBER",
    passwd VARCHAR(60) NOT NULL,
    PRIMARY KEY(userID)
);

CREATE TABLE menu_category(
    categoryID INT AUTO_INCREMENT,
    name VARCHAR(20) NOT NULL,
    PRIMARY KEY(categoryID)
);

CREATE TABLE menus(
    menuID INT AUTO_INCREMENT,
    menuName VARCHAR(30),
    price INT,
    description TEXT(1000),
    image TEXT(1000),
    categoryID INT,
    PRIMARY KEY(menuID),
    CONSTRAINT m_categoryID FOREIGN KEY (categoryID) REFERENCES menu_category(categoryID) ON DELETE SET NULL
);

CREATE TABLE tables(
    tableID INT AUTO_INCREMENT,
    code VARCHAR(4),
    userID INT,
    capacity INT NOT NULL,
    status TEXT CHECK(status IN ("AVAILABLE", "UNAVAILABLE", "RESERVED") ) NOT NULL DEFAULT "AVAILABLE",
    PRIMARY KEY (tableID)
);

CREATE TABLE coupon(
    couponID INT AUTO_INCREMENT,
    menuID INT,
    discount TEXT CHECK(discount IN ("0.5", "0.4", "0.3", "0.2", "0.15", "0.1", "0.05", "0.01") ) NOT NULL,
    cost INT NOT NULL,
    PRIMARY KEY (couponID)
);

CREATE TABLE user_discount(
    userID INT,
    menuID INT,
    discount TEXT CHECK(discount IN ("0.5", "0.4", "0.3", "0.2", "0.15", "0.1", "0.05", "0.01") ) NOT NULL,
    code VARCHAR(7),
    expire DATETIME NOT NULL,
    PRIMARY KEY (code),
    CONSTRAINT ucp_userID FOREIGN KEY (userID) REFERENCES users(userID) ON DELETE CASCADE
);